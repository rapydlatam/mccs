<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>MCCs PayU</title>
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #fafafa;
    }
    header {
      background: #5600EF;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 1.6em;
      font-weight: 700;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .search-lang-row {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    #mccInput, #langSelect, #exportBtn {
      font-family: 'Inter', Arial, sans-serif;
      font-size: 1em;
      padding: 8px 14px;
      border-radius: 6px;
      border: 1.5px solid #ccc;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
    }
    #mccInput:focus {
      border: 2px solid #5600EF;
      box-shadow: 0 2px 8px rgba(86,0,239,0.13);
    }
    #langSelect {
      cursor: pointer;
      border: 1.5px solid #5600EF;
      font-weight: 600;
      background: #fff;
    }
    #exportBtn {
      border: 1.5px solid #5600EF;
      background: #fff;
      color: #5600EF;
      font-weight: 600;
      cursor: pointer;
    }
    #exportBtn:hover {
      background: #f7f7fa;
      border: 2px solid #FF007A;
      box-shadow: 0 2px 8px rgba(255,0,122,0.13);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    th {
      background: #f0f0f5;
      font-weight: 600;
    }
    tr:hover {
      background: #faf6ff;
    }
  </style>
</head>
<body>
  <header>MCCs PayU</header>
  <div class="container">
    <div class="search-lang-row">
      <input type="text" id="mccInput" placeholder="Busca por MCC, actividad, descripción..." oninput="debouncedFiltrarMCC()" disabled>
      <select id="langSelect" onchange="cambiarIdioma()">
        <option value="es">ES</option>
        <option value="en">EN</option>
      </select>
      <button id="exportBtn" onclick="exportarMCC()">⬇ Exportar</button>
    </div>
    <table id="tablaMCC">
      <thead>
        <tr id="encabezados"></tr>
      </thead>
      <tbody id="cuerpoTabla"></tbody>
    </table>
  </div>

  <script>
    let datos = [];
    let datosCargados = false;
    let idioma = "es";
    let debounceTimeout;

    async function cargarDatos() {
      const archivo = idioma === "es" ? "mcc_es.json" : "mcc_en.json";
      try {
        const resp = await fetch(archivo);
        datos = await resp.json();
        datosCargados = true;
        document.getElementById("mccInput").disabled = false;
        mostrarDatos(datos);
      } catch (e) {
        console.error("Error cargando JSON:", e);
      }
    }

    function mostrarDatos(lista) {
      if (!lista || lista.length === 0) return;
      const encabezados = Object.keys(lista[0]);
      const thead = document.getElementById("encabezados");
      thead.innerHTML = encabezados.map(h => `<th>${h}</th>`).join("");
      const tbody = document.getElementById("cuerpoTabla");
      tbody.innerHTML = lista.map(row =>
        `<tr>${encabezados.map(h => `<td>${row[h]}</td>`).join("")}</tr>`
      ).join("");
    }

    function filtrarMCC() {
      const valor = document.getElementById("mccInput").value.toLowerCase();
      const filtrados = datos.filter(row =>
        Object.values(row).some(v => v.toString().toLowerCase().includes(valor))
      );
      mostrarDatos(filtrados);
    }

    function debouncedFiltrarMCC() {
      clearTimeout(debounceTimeout);
      debounceTimeout = setTimeout(filtrarMCC, 300);
    }

    function cambiarIdioma() {
      idioma = document.getElementById("langSelect").value;
      cargarDatos();
    }

    function exportarMCC() {
      if (!datosCargados || !Array.isArray(datos) || datos.length === 0) {
        alert("No hay datos para exportar.");
        return;
      }
      const encabezados = Object.keys(datos[0]);
      const filas = datos.map(row =>
        encabezados.map(h => `"${(row[h] || "").toString().replace(/"/g, '""')}"`).join(",")
      );
      const csvContent = [encabezados.join(","), ...filas].join("\n");

      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", idioma === "es" ? "MCC_PayU_ES.csv" : "MCC_PayU_EN.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Inicial
    cargarDatos();
  </script>
</body>
</html>
